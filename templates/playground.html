<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Python Playground - PythonLearn</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Animation Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>

    <!-- CodeMirror for Code Editor -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/monokai.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/python/python.min.js"></script>

    <!-- Custom Styles -->
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap");
      @import url("https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600&display=swap");

      :root {
        --primary-color: #0d9488;
        --secondary-color: #1e293b;
        --accent-color: #f97316;
        --text-primary: #1f2937;
        --text-secondary: #6b7280;
        --bg-primary: #ffffff;
        --bg-secondary: #f9fafb;
      }

      [data-theme="dark"] {
        --text-primary: #f1f5f9;
        --text-secondary: #94a3b8;
        --bg-primary: #0f172a;
        --bg-secondary: #1e293b;
      }

      * {
        font-family: "Inter", sans-serif;
      }

      body {
        background: var(--bg-primary);
        color: var(--text-primary);
        transition: all 0.3s ease;
      }

      .glassmorphism {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .nav-link {
        position: relative;
        transition: all 0.3s ease;
      }

      .nav-link.active::after {
        content: "";
        position: absolute;
        bottom: -4px;
        left: 0;
        right: 0;
        height: 2px;
        background: #0d9488;
      }

      .code-editor-container {
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      }

      .CodeMirror {
        height: 400px;
        font-family: "JetBrains Mono", monospace;
        font-size: 14px;
      }

      .output-panel {
        background: #0f172a;
        color: #e2e8f0;
        font-family: "JetBrains Mono", monospace;
        border-radius: 8px;
        padding: 1rem;
        min-height: 200px;
        border: 1px solid #334155;
        overflow-y: auto;
      }

      .output-panel .output-line {
        margin-bottom: 0.25rem;
        padding: 0.25rem 0;
      }

      .output-panel .error {
        color: #ef4444;
      }

      .output-panel .success {
        color: #10b981;
      }

      .output-panel .info {
        color: #3b82f6;
      }

      .toolbar {
        background: var(--bg-secondary);
        border-bottom: 1px solid #e5e7eb;
        padding: 0.75rem 1rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .toolbar-button {
        display: inline-flex;
        align-items: center;
        padding: 0.5rem 1rem;
        border-radius: 6px;
        font-size: 0.875rem;
        font-weight: 500;
        transition: all 0.2s ease;
        border: 1px solid transparent;
      }

      .toolbar-button.primary {
        background: #0d9488;
        color: white;
      }

      .toolbar-button.primary:hover {
        background: #0f766e;
      }

      .toolbar-button.secondary {
        background: white;
        color: #374151;
        border-color: #d1d5db;
      }

      .toolbar-button.secondary:hover {
        background: #f9fafb;
      }

      .file-tree {
        background: var(--bg-secondary);
        border-radius: 8px;
        padding: 1rem;
        height: 500px;
        overflow-y: auto;
      }

      .file-item {
        display: flex;
        align-items: center;
        padding: 0.5rem;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.2s ease;
        margin-bottom: 2px;
      }

      .file-item:hover {
        background: #e5e7eb;
      }

      .file-item.active {
        background: #0d9488;
        color: white;
      }

      .file-icon {
        margin-right: 0.5rem;
        font-size: 1rem;
      }

      .examples-panel {
        background: white;
        border-radius: 8px;
        padding: 1rem;
        height: 300px;
        overflow-y: auto;
        border: 1px solid #e5e7eb;
      }

      .example-item {
        padding: 0.75rem;
        border-radius: 6px;
        cursor: pointer;
        transition: background-color 0.2s ease;
        margin-bottom: 0.5rem;
        border: 1px solid #f3f4f6;
      }

      .example-item:hover {
        background: #f9fafb;
      }

      .example-item h4 {
        font-weight: 600;
        margin-bottom: 0.25rem;
        color: #1f2937;
      }

      .example-item p {
        font-size: 0.875rem;
        color: #6b7280;
      }

      .status-bar {
        background: var(--bg-secondary);
        border-top: 1px solid #e5e7eb;
        padding: 0.5rem 1rem;
        font-size: 0.75rem;
        color: #6b7280;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .loading-spinner {
        display: inline-block;
        width: 16px;
        height: 16px;
        border: 2px solid #f3f3f3;
        border-top: 2px solid #0d9488;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .tab-container {
        display: flex;
        background: var(--bg-secondary);
        border-bottom: 1px solid #e5e7eb;
      }

      .tab {
        padding: 0.75rem 1rem;
        cursor: pointer;
        border-right: 1px solid #e5e7eb;
        transition: background-color 0.2s ease;
        display: flex;
        align-items: center;
      }

      .tab:hover {
        background: #e5e7eb;
      }
      .tab.active {
        background: white;
        border-bottom: 2px solid #0d9488;
      }

      .tab-close {
        margin-left: 0.5rem;
        padding: 0.125rem;
        border-radius: 2px;
        transition: background-color 0.2s ease;
      }

      .tab-close:hover {
        background: #d1d5db;
      }

      @media (max-width: 768px) {
        .playground-layout {
          flex-direction: column;
        }

        .sidebar-panel {
          order: 2;
        }

        .main-panel {
          order: 1;
        }

        .CodeMirror {
          height: 300px;
        }
      }
    </style>
  </head>
  <body>
    <!-- Navigation -->
    <nav class="fixed top-0 left-0 right-0 z-50 glassmorphism bg-teal-700">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-16">
          <!-- Logo -->
          <div class="flex items-center">
            <div class="text-2xl font-bold text-white">üêç PythonLearn</div>
          </div>

          <!-- Desktop Navigation -->
          <div class="hidden md:flex items-center space-x-10">
            <a
              href="/"
              class="nav-link text-slate-700 hover:text-primary-600 px-3 py-2 active"
              >Home</a
            >
            <a
              href="/course"
              class="nav-link text-slate-700 hover:text-primary-600 px-3 py-2"
              >Course</a
            >
            <a
              href="/playground"
              class="nav-link text-slate-700 hover:text-primary-600 px-3 py-2"
              >Playground</a
            >
            <a
              href="/quiz"
              class="nav-link text-slate-700 hover:text-primary-600 px-3 py-2"
              >Quiz</a
            >
            <a
              href="/projects"
              class="nav-link text-slate-700 hover:text-primary-600 px-3 py-2"
              >Projects</a
            >
            <a
              href="/login"
              class="nav-link text-slate-700 hover:text-primary-600 px-3 py-2"
              >signup</a
            >
            <button
              id="theme-toggle"
              class="p-3 rounded-xl text-slate-700 hover:bg-slate-100 hover:text-primary-600 transition-all duration-300"
            >
              <span id="theme-icon">üåô</span>
            </button>
          </div>

          <!-- Mobile Menu Button -->
          <div class="md:hidden">
            <button id="mobile-menu-btn" class="text-white hover:text-teal-300">
              <svg
                class="w-6 h-6"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M4 6h16M4 12h16M4 18h16"
                ></path>
              </svg>
            </button>
          </div>
        </div>

        <!-- Mobile Navigation -->
        <div id="mobile-menu" class="hidden md:hidden">
          <div
            class="px-2 pt-2 pb-3 space-y-1 bg-black bg-opacity-50 rounded-lg mt-2"
          >
            <a
              href="index.html"
              class="block px-3 py-2 text-white hover:text-teal-300"
              >Home</a
            >
            <a
              href="course.html"
              class="block px-3 py-2 text-white hover:text-teal-300"
              >Course</a
            >
            <a
              href="playground.html"
              class="block px-3 py-2 text-white hover:text-teal-300"
              >Playground</a
            >
            <a
              href="quiz.html"
              class="block px-3 py-2 text-white hover:text-teal-300"
              >Quiz</a
            >
            <a
              href="projects.html"
              class="block px-3 py-2 text-white hover:text-teal-300"
              >Projects</a
            >
            <a
              href="about.html"
              class="block px-3 py-2 text-white hover:text-teal-300"
              >About</a
            >
          </div>
        </div>
      </div>
    </nav>

    <!-- Playground Header -->
    <section
      class="pt-20 pb-8 bg-gradient-to-r from-teal-600 to-blue-600 text-white"
    >
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center">
          <h1 class="text-4xl md:text-5xl font-bold mb-4">Python Playground</h1>
          <p class="text-xl mb-8 max-w-3xl mx-auto">
            Write, run, and experiment with Python code in your browser. Perfect
            for learning, testing ideas, and building projects.
          </p>
          <div class="flex flex-wrap justify-center gap-4 text-sm">
            <span class="bg-white bg-opacity-20 px-4 py-2 rounded-full"
              >Real-time Execution</span
            >
            <span class="bg-white bg-opacity-20 px-4 py-2 rounded-full"
              >Syntax Highlighting</span
            >
            <span class="bg-white bg-opacity-20 px-4 py-2 rounded-full"
              >Error Detection</span
            >
            <span class="bg-white bg-opacity-20 px-4 py-2 rounded-full"
              >Code Examples</span
            >
          </div>
        </div>
      </div>
    </section>
    <!-- CHATBOT -->
    <div class="fixed bottom-4 right-4 z-50">
      <!-- Toggle button (optional) -->
      <button
        id="chat-toggle"
        class="mb-3 ml-auto flex h-14 w-14 items-center justify-center rounded-full bg-indigo-600 text-white shadow-lg transition hover:bg-indigo-500 focus:outline-none focus:ring-4 focus:ring-indigo-300"
      >
        <svg
          id="chat-icon"
          class="h-6 w-6"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"
          />
        </svg>
      </button>

      <!-- Chat card -->
      <div
        id="chat-card"
        class="hidden w-80 rounded-2xl bg-white shadow-2xl ring-1 ring-slate-200 transition-all duration-300"
      >
        <!-- Header -->
        <div
          class="flex items-center justify-between rounded-t-2xl bg-indigo-600 px-4 py-3"
        >
          <div class="flex items-center space-x-3">
            <span class="text-2xl">üêç</span>
            <div>
              <p class="font-semibold text-white">Python Tutor</p>
              <p class="text-xs text-indigo-200">Online</p>
            </div>
          </div>
          <button
            onclick="document.getElementById('chat-card').classList.add('hidden')"
            class="text-indigo-200 hover:text-white"
          >
            <svg
              class="h-5 w-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M6 18L18 6M6 6l12 12"
              />
            </svg>
          </button>
        </div>

        <!-- Messages -->
        <div
          id="chat-log"
          class="h-80 overflow-y-auto p-4 space-y-3 bg-slate-50"
        ></div>

        <!-- Input -->
        <form
          onsubmit="sendChat(); return false;"
          class="flex items-center gap-2 border-t border-slate-200 p-3 bg-white rounded-b-2xl"
        >
          <input
            id="chat-input"
            type="text"
            placeholder="Ask about Python‚Ä¶"
            class="w-full rounded-full border border-slate-300 px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-400"
          />
          <button
            type="submit"
            class="flex h-10 w-10 items-center justify-center rounded-full bg-indigo-600 text-white shadow hover:bg-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-400"
          >
            <svg
              class="h-5 w-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"
              />
            </svg>
          </button>
        </form>
      </div>
    </div>

    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <script>
      /* --- keep your original JS, just add animations & scroll --- */
      async function sendChat() {
        const input = document.getElementById("chat-input");
        const msg = input.value.trim();
        if (!msg) return;

        appendMessage("You", msg, "user");
        input.value = "";
        scrollBottom();

        const res = await fetch("/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message: msg }),
        });
        const data = await res.json();
        appendMessage("Tutor", data.reply, "bot");
        scrollBottom();
      }

      function appendMessage(sender, text, side) {
        const log = document.getElementById("chat-log");
        const wrap = document.createElement("div");
        wrap.className =
          "flex " + (side === "user" ? "justify-end" : "justify-start");
        const bubble = document.createElement("div");
        bubble.className =
          side === "user"
            ? "max-w-xs px-4 py-2 rounded-2xl bg-indigo-600 text-white shadow animate-fade-in-up"
            : "max-w-xs px-4 py-2 rounded-2xl bg-white text-slate-800 shadow ring-1 ring-slate-200 animate-fade-in-up";
        bubble.innerText = text;
        wrap.appendChild(bubble);
        log.appendChild(wrap);
      }

      function scrollBottom() {
        const log = document.getElementById("chat-log");
        log.scrollTop = log.scrollHeight;
      }

      /* toggle chat window */
      document.getElementById("chat-toggle").onclick = () => {
        document.getElementById("chat-card").classList.toggle("hidden");
      };

      /* add keyframe animation via Tailwind plugin */
      tailwind.config = {
        theme: {
          extend: {
            keyframes: {
              "fade-in-up": {
                "0%": { opacity: "0", transform: "translateY(10px)" },
                "100%": { opacity: "1", transform: "translateY(0)" },
              },
            },
            animation: {
              "fade-in-up": "fade-in-up .35s ease-out",
            },
          },
        },
      };
    </script>
    <!-- Main Playground Interface -->
    <section class="py-8">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex flex-col lg:flex-row gap-6 playground-layout">
          <!-- Sidebar Panel -->
          <div class="lg:w-1/4 sidebar-panel">
            <!-- File Explorer -->
            <div class="mb-6">
              <h3 class="text-lg font-semibold mb-3">File Explorer</h3>
              <div class="file-tree">
                <div class="file-item active" data-file="main.py">
                  <span class="file-icon">üêç</span>
                  <span>main.py</span>
                </div>
                <div class="file-item" data-file="examples.py">
                  <span class="file-icon">üìÑ</span>
                  <span>examples.py</span>
                </div>
                <div class="file-item" data-file="utils.py">
                  <span class="file-icon">üîß</span>
                  <span>utils.py</span>
                </div>
                <div class="file-item" data-file="data.txt">
                  <span class="file-icon">üìä</span>
                  <span>data.txt</span>
                </div>
              </div>
            </div>

            <!-- Code Examples -->
            <div>
              <h3 class="text-lg font-semibold mb-3">Code Examples</h3>
              <div class="examples-panel">
                <div class="example-item" data-example="hello-world">
                  <h4>Hello World</h4>
                  <p>Basic print statement</p>
                </div>
                <div class="example-item" data-example="variables">
                  <h4>Variables & Data Types</h4>
                  <p>Working with different data types</p>
                </div>
                <div class="example-item" data-example="loops">
                  <h4>For Loops</h4>
                  <p>Iterating with for loops</p>
                </div>
                <div class="example-item" data-example="functions">
                  <h4>Functions</h4>
                  <p>Defining and using functions</p>
                </div>
                <div class="example-item" data-example="lists">
                  <h4>Lists & Lists Operations</h4>
                  <p>Working with list data structures</p>
                </div>
                <div class="example-item" data-example="calculator">
                  <h4>Simple Calculator</h4>
                  <p>Basic arithmetic operations</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Main Panel -->
          <div class="lg:w-3/4 main-panel">
            <!-- Tab Bar -->
            <div class="tab-container">
              <div class="tab active" data-tab="main.py">
                <span>main.py</span>
                <span class="tab-close">√ó</span>
              </div>
            </div>

            <!-- Toolbar -->
            <div class="toolbar">
              <div class="flex items-center space-x-2">
                <button id="run-code" class="toolbar-button primary">
                  ‚ñ∂Ô∏è Run Code
                </button>
                <button id="save-code" class="toolbar-button secondary">
                  üíæ Save
                </button>
                <button id="share-code" class="toolbar-button secondary">
                  üîó Share
                </button>
                <button id="clear-code" class="toolbar-button secondary">
                  üóëÔ∏è Clear
                </button>
              </div>
              <div class="flex items-center space-x-2 text-sm text-gray-600">
                <span>Python 3.9</span>
                <span>‚Ä¢</span>
                <span id="cursor-position">Line 1, Col 1</span>
              </div>
            </div>

            <!-- Code Editor -->
            <div class="code-editor-container">
              <textarea
                id="code-editor"
                placeholder="# Welcome to Python Playground!
# Write your Python code here and click 'Run Code' to execute it.

print('Hello, Python World!')
print('This is your interactive playground')

# Try some math
x = 10
y = 5
result = x + y
print(f'{x} + {y} = {result}')

# Try a loop
for i in range(5):
    print(f'Count: {i}')

print('Happy coding! üêç')"
              ></textarea>
            </div>

            <!-- Output Panel -->
            <div class="mt-4">
              <div class="flex items-center justify-between mb-2">
                <h3 class="text-lg font-semibold">Output</h3>
                <button
                  id="clear-output"
                  class="text-sm text-gray-600 hover:text-gray-800"
                >
                  Clear Output
                </button>
              </div>
              <div class="output-panel" id="output-panel">
                <div class="output-line info">Python Playground v1.0</div>
                <div class="output-line info">
                  Ready to execute your code...
                </div>
                <div class="output-line">
                  Click 'Run Code' to see the output!
                </div>
              </div>
            </div>

            <!-- Status Bar -->
            <div class="status-bar">
              <div class="flex items-center space-x-4">
                <span id="execution-status">Ready</span>
                <span id="execution-time"></span>
              </div>
              <div class="flex items-center space-x-4">
                <span>UTF-8</span>
                <span>Python</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Tips Section -->
    <section class="py-12 bg-gray-50">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <h2 class="text-3xl font-bold text-center mb-8">Playground Tips</h2>
        <div class="grid md:grid-cols-3 gap-8">
          <div class="bg-white p-6 rounded-lg shadow-lg">
            <div class="text-3xl mb-4">‚å®Ô∏è</div>
            <h3 class="text-xl font-semibold mb-2">Keyboard Shortcuts</h3>
            <ul class="text-gray-600 space-y-1">
              <li>‚Ä¢ Ctrl/Cmd + Enter: Run code</li>
              <li>‚Ä¢ Ctrl/Cmd + S: Save code</li>
              <li>‚Ä¢ Ctrl/Cmd + /: Comment line</li>
              <li>‚Ä¢ Tab: Auto-complete</li>
            </ul>
          </div>

          <div class="bg-white p-6 rounded-lg shadow-lg">
            <div class="text-3xl mb-4">üêõ</div>
            <h3 class="text-xl font-semibold mb-2">Debugging Tips</h3>
            <ul class="text-gray-600 space-y-1">
              <li>‚Ä¢ Use print() to debug</li>
              <li>‚Ä¢ Check indentation carefully</li>
              <li>‚Ä¢ Watch for syntax errors</li>
              <li>‚Ä¢ Test code step by step</li>
            </ul>
          </div>

          <div class="bg-white p-6 rounded-lg shadow-lg">
            <div class="text-3xl mb-4">üöÄ</div>
            <h3 class="text-xl font-semibold mb-2">Advanced Features</h3>
            <ul class="text-gray-600 space-y-1">
              <li>‚Ä¢ Import external libraries</li>
              <li>‚Ä¢ Use built-in functions</li>
              <li>‚Ä¢ Create multiple files</li>
              <li>‚Ä¢ Share your code</li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white py-12">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="grid md:grid-cols-4 gap-8">
          <div>
            <div class="text-2xl font-bold mb-4">üêç PythonLearn</div>
            <p class="text-gray-400 mb-4">
              Learn Python the smart way with our interactive platform designed
              for modern learners.
            </p>
          </div>

          <div>
            <h4 class="font-bold mb-4">Learning</h4>
            <ul class="space-y-2 text-gray-400">
              <li>
                <a href="course.html" class="hover:text-white"
                  >Course Curriculum</a
                >
              </li>
              <li>
                <a href="playground.html" class="hover:text-white"
                  >Code Playground</a
                >
              </li>
              <li>
                <a href="quiz.html" class="hover:text-white"
                  >Interactive Quizzes</a
                >
              </li>
              <li>
                <a href="projects.html" class="hover:text-white"
                  >Project Gallery</a
                >
              </li>
            </ul>
          </div>

          <div>
            <h4 class="font-bold mb-4">Resources</h4>
            <ul class="space-y-2 text-gray-400">
              <li>
                <a href="about.html" class="hover:text-white">About Us</a>
              </li>
              <li><a href="#" class="hover:text-white">Blog</a></li>
              <li><a href="#" class="hover:text-white">Documentation</a></li>
              <li><a href="#" class="hover:text-white">Community</a></li>
            </ul>
          </div>

          <div>
            <h4 class="font-bold mb-4">Support</h4>
            <ul class="space-y-2 text-gray-400">
              <li><a href="#" class="hover:text-white">Help Center</a></li>
              <li><a href="#" class="hover:text-white">Contact Us</a></li>
              <li><a href="#" class="hover:text-white">Privacy Policy</a></li>
              <li><a href="#" class="hover:text-white">Terms of Service</a></li>
            </ul>
          </div>
        </div>

        <div
          class="border-t border-gray-800 mt-8 pt-8 text-center text-gray-400"
        >
          <p>
            &copy; 2024 PythonLearn. All rights reserved. Made with ‚ù§Ô∏è for
            Python learners worldwide.
          </p>
        </div>
      </div>
    </footer>

    <!-- Main JavaScript -->
    <script src="{{url_for('static', filename='main.js')}}"></script>

    <!-- Playgrund-specific JavaScript -->

    <script src="https://cdn.jsdelivr.net/npm/skulpt@1.2.0/dist/skulpt.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/skulpt@1.2.0/dist/skulpt-stdlib.js"></script>

    <script>
            const res = await fetch(
        "https://api-inference.huggingface.co/models/microsoft/DialoGPT-medium",
        {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ inputs: msg }),
        }
      );
      const json = await res.json();
      const reply = Array.isArray(json) ? json[0].generated_text : json.generated_text;
            /* ==========================================================
         PYTHON PLAYGROUND  ‚Äì  fixed & self-contained
         ========================================================== */
            class PythonPlayground {
              constructor() {
                this.editor = null;
                this.currentFile = "main.py";

                // default file set
                this.files = {
                  "main.py": `# Welcome to Python Playground!
      print('Hello, Python World!')
      print('This is your interactive playground')

      # Try some math
      x = 10
      y = 5
      result = x + y
      print(f'{x} + {y} = {result}')

      # Try a loop
      for i in range(5):
          print(f'Count: {i}')

      print('Happy coding! üêç')`,
                  "examples.py": `import math, random
      squares = [x**2 for x in range(10)]
      print("Squares:", squares)`,
                  "utils.py": `def greet(name):
          return f"Hello, {name}!"
      print(greet("Python Learner"))`,
                  "data.txt": `Name,Age,Score
      Alice,20,85
      Bob,22,78`,
                };

                // quick example snippets
                this.examples = {
                  "hello-world": {
                    title: "Hello World",
                    code: `print("Hello, world!")`,
                  },
                  variables: {
                    title: "Variables",
                    code: `a = 5\nb = 7\nprint(a + b)`,
                  },
                  loops: {
                    title: "For Loop",
                    code: `for i in range(3):\n    print(i)`,
                  },
                  functions: {
                    title: "Function",
                    code: `def add(x,y):\n    return x+y\nprint(add(3,4))`,
                  },
                  lists: {
                    title: "Lists",
                    code: `nums = [1,2,3]\nnums.append(4)\nprint(nums)`,
                  },
                  calculator: {
                    title: "Calculator",
                    code: `expr = input("Enter math: ")\nprint(eval(expr))`,
                  },
                };

                this.init();
              }

              /* -------------------------------------------------- */
              init() {
                this.setupEditor();
                this.setupEventListeners();
                this.loadFile("main.py");
                this.loadSavedCode(); // restore last session
              }

              setupEditor() {
                const ta = document.getElementById("code-editor");
                this.editor = CodeMirror.fromTextArea(ta, {
                  mode: "python",
                  theme: "monokai",
                  lineNumbers: true,
                  autoCloseBrackets: true,
                  matchBrackets: true,
                  indentUnit: 4,
                  tabSize: 4,
                  lineWrapping: true,
                  foldGutter: true,
                  gutters: ["CodeMirror-linenumbers", "CodeMirror-foldgutter"],
                });

                // cursor position
                this.editor.on("cursorActivity", () => {
                  const c = this.editor.getCursor();
                  document.getElementById("cursor-position").textContent = `Line ${
                    c.line + 1
                  }, Col ${c.ch + 1}`;
                });

                // auto-save
                this.editor.on("change", () => {
                  this.files[this.currentFile] = this.editor.getValue();
                });
              }

              setupEventListeners() {
                // file explorer
                document.querySelectorAll(".file-item").forEach((item) => {
                  item.addEventListener("click", (e) => {
                    this.loadFile(item.dataset.file);
                    document
                      .querySelectorAll(".file-item")
                      .forEach((f) => f.classList.remove("active"));
                    item.classList.add("active");
                  });
                });

                // example loader
                document.querySelectorAll(".example-item").forEach((item) => {
                  item.addEventListener("click", (e) => {
                    const ex = this.examples[item.dataset.example];
                    if (ex) {
                      this.editor.setValue(ex.code);
                      this.addOutput("info", `Loaded example: ${ex.title}`);
                    }
                  });
                });

                // toolbar
                document
                  .getElementById("run-code")
                  .addEventListener("click", () => this.runCode());
                document
                  .getElementById("clear-output")
                  .addEventListener("click", () => this.clearOutput());
                document
                  .getElementById("save-code")
                  .addEventListener("click", () => this.saveCode());
                document
                  .getElementById("share-code")
                  .addEventListener("click", () => this.shareCode());
                document
                  .getElementById("clear-code")
                  .addEventListener("click", () => this.clearCode());

                // keyboard shortcuts
                document.addEventListener("keydown", (e) => {
                  if ((e.ctrlKey || e.metaKey) && e.key === "Enter") {
                    e.preventDefault();
                    this.runCode();
                  }
                  if ((e.ctrlKey || e.metaKey) && e.key === "s") {
                    e.preventDefault();
                    this.saveCode();
                  }
                });
              }

              /* -------------------------------------------------- */
              loadFile(filename) {
                this.currentFile = filename;
                const content =
                  this.files[filename] ||
                  `# File: ${filename}\nprint("Hello from ${filename}!")`;
                this.editor.setValue(content);
                this.updateTab(filename);
                this.updateStatus(`Loaded ${filename}`);
              }
              updateTab(filename) {
                const tabs = document.querySelectorAll(".tab");
                tabs.forEach((t) => t.classList.remove("active"));
                let tab = Array.from(tabs).find((t) => t.dataset.tab === filename);
                if (!tab) {
                  tab = document.createElement("div");
                  tab.className = "tab active";
                  tab.dataset.tab = filename;
                  tab.innerHTML = `<span>${filename}</span><span class="tab-close">√ó</span>`;
                  document.querySelector(".tab-container").appendChild(tab);
                }
                tab.classList.add("active");
              }
              updateStatus(msg, loading = false) {
                const status = document.getElementById("execution-status");
                status.innerHTML = loading
                  ? `<div class="loading-spinner"></div> ${msg}`
                  : msg;
              }

              /* -------------------------------------------------- */
              /*  REAL PYTHON 3.x via Skulpt                        */
              /* -------------------------------------------------- */
              runCode() {
                const code = this.editor.getValue().trim();
                if (!code) {
                  this.addOutput("error", "No code to execute!");
                  return;
                }

                this.clearOutput();
                this.updateStatus("Running‚Ä¶", true);
                const start = performance.now();

                Sk.pre = "output-panel";
                Sk.configure({
                  output: (text) => this.addOutput("normal", text),
                  read: (fname) => {
                    if (
                      Sk.builtinFiles === undefined ||
                      Sk.builtinFiles.files[fname] === undefined
                    )
                      throw new Error("File not found: " + fname);
                    return Sk.builtinFiles.files[fname];
                  },
                  __future__: Sk.python3,
                  execLimit: 15000, // 15 s
                  yieldLimit: 300,
                });

                const promise = Sk.misceval.asyncToPromise(() =>
                  Sk.importMainWithBody("<stdin>", false, code, true)
                );

                promise.then(
                  () => {
                    // SUCCESS
                    const t = ((performance.now() - start) / 1000).toFixed(3);
                    this.updateStatus(`Done in ${t} s`);
                  },
                  (err) => {
                    // ERROR
                    this.addOutput("error", err.toString());
                    this.updateStatus("Error");
                  }
                );
              }

              /* -------------------------------------------------- */
              addOutput(type, message) {
                const panel = document.getElementById("output-panel");
                const line = document.createElement("div");
                line.className = `output-line ${type}`;
                line.textContent = message;
                panel.appendChild(line);
                panel.scrollTop = panel.scrollHeight;
              }
              clearOutput() {
                document.getElementById("output-panel").innerHTML =
                  '<div class="output-line info">Ready to execute your code‚Ä¶</div>';
              }
              clearCode() {
                if (confirm("Clear editor?")) {
                  this.editor.setValue("");
                  this.updateStatus("Editor cleared");
                }
              }
              saveCode() {
                localStorage.setItem("playground-code", JSON.stringify(this.files));
                this.updateStatus("Code saved");
                this.addOutput("success", "Code saved to browser storage");
              }
              shareCode() {
                const code = this.editor.getValue();
                navigator.clipboard.writeText(code).then(() => {
                  this.updateStatus("Code copied");
                  this.addOutput("success", "Code copied to clipboard");
                });
              }
              loadSavedCode() {
                const saved = localStorage.getItem("playground-code");
                if (saved) {
                  try {
                    this.files = JSON.parse(saved);
                  } catch (e) {
                    /* ignore */
                  }
                }
              }
            }

            /* ==========================================================
         INITIALISE ON PAGE LOAD
         ========================================================== */
            document.addEventListener("DOMContentLoaded", () => {
              window.playground = new PythonPlayground();
            });
    </script>
  </body>
</html>
